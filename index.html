<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>نظام Web OCR الذكي</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f2f2f2;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #2c3e50;
    }
    select, input[type="file"] {
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #result {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 20px;
      direction: rtl;
    }
  </style>

  <!-- مكتبة OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>🔍 نظام Web OCR الذكي لجميع ألعاب Linebet / 1xBet</h1>

  <label for="gameSelect">اختر اللعبة:</label>
  <select id="gameSelect">
    <!-- نفس الخيارات كما هي -->
    <optgroup label="🎯 Crash Games">
      <option value="Aviator">Aviator</option>
      <option value="JetX">JetX</option>
      <option value="Zeppelin">Zeppelin</option>
    </optgroup>
    <optgroup label="💣 ألعاب الألغام">
      <option value="Mines">Mines</option>
      <option value="Safe Box">Safe Box</option>
      <option value="Gold Mines">Gold Mines</option>
    </optgroup>
    <optgroup label="🎡 ألعاب العجلة">
      <option value="Wheel of Fortune">Wheel of Fortune</option>
      <option value="Mega Wheel">Mega Wheel</option>
      <option value="Spaceman">Spaceman</option>
    </optgroup>
    <optgroup label="🎰 كازينو">
      <option value="Blackjack">Blackjack</option>
      <option value="Andar Bahar">Andar Bahar</option>
      <option value="Teen Patti">Teen Patti</option>
      <option value="Baccarat">Baccarat</option>
      <option value="Dragon Tiger">Dragon Tiger</option>
    </optgroup>
    <optgroup label="🎲 ألعاب النرد">
      <option value="Dice">Dice</option>
      <option value="HiLo">HiLo</option>
      <option value="Sic Bo">Sic Bo</option>
    </optgroup>
    <optgroup label="🧱 ألعاب Plinko">
      <option value="Plinko Classic">Plinko Classic</option>
      <option value="Plinko X">Plinko X</option>
    </optgroup>
    <optgroup label="🏁 سباقات افتراضية">
      <option value="Horse Racing">Horse Racing</option>
      <option value="Dog Racing">Dog Racing</option>
    </optgroup>
    <optgroup label="⚽ رياضة افتراضية">
      <option value="Virtual Football">Virtual Football</option>
      <option value="Virtual Tennis">Virtual Tennis</option>
    </optgroup>
    <optgroup label="🎮 ألعاب مصغرة">
      <option value="777">777</option>
      <option value="XO">XO</option>
      <option value="Fruit Blast">Fruit Blast</option>
    </optgroup>
    <optgroup label="🧠 أخرى">
      <option value="Crash X">Crash X</option>
      <option value="Penalty Shootout">Penalty Shootout</option>
      <option value="Goal">Goal</option>
      <option value="Rock Paper Scissors">Rock Paper Scissors</option>
    </optgroup>
  </select>

  <br/>
  <input type="file" id="imageInput" accept="image/*" />
  <div id="result">📄 نتائج التحليل ستظهر هنا...</div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCijdq8Ji8L9e3dGoHK72LaAUWsz_e5V6Y",
      authDomain: "web-ocr-ai.firebaseapp.com",
      projectId: "web-ocr-ai",
      storageBucket: "web-ocr-ai.appspot.com",
      messagingSenderId: "847993614836",
      appId: "1:847993614836:web:a2b6e91c94426dd01549a1",
      measurementId: "G-TTQZPVWFL4"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ✅ التحليل الذكي بعد OCR
    function analyzeGameText(game, text) {
      let recommendation = "🧠 جاري تطوير التوصيات لهذه اللعبة...";
      const lowerText = text.toLowerCase();

      if (game === "Aviator") {
        const matches = lowerText.match(/(\d+(\.\d+)?)(x)/g);
        if (matches && matches.length > 3) {
          const last = parseFloat(matches[matches.length - 1]);
          const prev = parseFloat(matches[matches.length - 2]);
          const trend = last > prev ? "تصاعدي 🔺" : "تنازلي 🔻";
          recommendation = `📈 النمط الحالي: ${trend}<br>🎯 التوصية: انتظر مضاعفة مرتفعة ثم ادخل بقيمة صغيرة.`;
        }
      }

      else if (game === "Mines") {
        if (lowerText.includes("bomb") || lowerText.includes("mine")) {
          recommendation = "💣 اللعبة تحتوي على ألغام — جرب النقر من المنتصف أولًا.";
        }
      }

      else if (game === "Dice") {
        const numbers = text.match(/\b\d+\b/g);
        if (numbers && numbers.length > 4) {
          const avg = numbers.reduce((a, b) => a + parseInt(b), 0) / numbers.length;
          recommendation = avg > 50 ? "🎲 الأرقام مرتفعة — جرب العب على +50." : "🎲 الأرقام منخفضة — جرب العب على -50.";
        }
      }

      // ألعاب أخرى يمكن تطوير تحليلها لاحقًا
      return recommendation;
    }

    // OCR والتحليل
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const game = document.getElementById('gameSelect').value;
      const resultDiv = document.getElementById('result');

      if (!file) return;

      resultDiv.innerHTML = "⏳ جاري تحليل الصورة...";

      Tesseract.recognize(
        file,
        'ara', // اللغة العربية
        {
          logger: m => console.log(m)
        }
      ).then(({ data: { text } }) => {
        const timestamp = Date.now();
        const recommendation = analyzeGameText(game, text);

        resultDiv.innerHTML = `
          <b>🎮 اللعبة:</b> ${game}<br>
          <b>📄 النص المستخرج:</b><br>${text}<hr>
          <b>🤖 التوصية الذكية:</b><br>${recommendation}
        `;

        database.ref('ocr-results/' + timestamp).set({
          game: game,
          text: text,
          recommendation: recommendation,
          time: new Date().toLocaleString()
        });
      }).catch(err => {
        resultDiv.innerHTML = "❌ حدث خطأ أثناء التحليل.";
        console.error(err);
      });
    });
  </script>
</body>
</html>
