<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Web OCR</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    input[type="file"] {
      margin: 20px 0;
    }
    #result {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      font-size: 16px;
      text-align: right;
    }
  </style>
</head>
<body>
  <h1>ğŸ“· Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù„ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ - Web OCR</h1>
  <p>Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ù„Ø¹Ø¨Ø© ÙÙŠ Linebet Ø£Ùˆ 1xBet</p>
  <input type="file" accept="image/*" onchange="handleImage(event)">
  <div id="result">âš™ï¸ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØµÙˆØ±Ø© Ù„ØªØ­Ù„ÙŠÙ„Ù‡Ø§...</div>

  <!-- Ù…ÙƒØªØ¨Ø© OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

  <script>
    const resultDiv = document.getElementById('result');

    function handleImage(event) {
      const file = event.target.files[0];
      if (!file) return;

      resultDiv.textContent = 'ğŸ“¤ Ø¬Ø§Ø±Ù ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©...';

      Tesseract.recognize(file, 'eng', {
        logger: m => console.log(m)
      }).then(({ data: { text } }) => {
        const cleanedText = text.trim();
        resultDiv.textContent = 'ğŸ§  Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ³ØªØ®Ø±Ø¬:\n' + cleanedText;

        // ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù…Ø¨Ø¯Ø¦ÙŠ Ù…Ø­Ù„ÙŠ (Ø¨Ø³ÙŠØ·)
        const aiResultDiv = document.createElement('div');
        aiResultDiv.style.marginTop = '20px';
        aiResultDiv.style.color = '#006600';

        if (cleanedText.includes('win') || cleanedText.includes('Victory') || cleanedText.includes('x2')) {
          aiResultDiv.textContent = 'âœ… ØªØ­Ù„ÙŠÙ„ AI: Ø§Ø­ØªÙ…Ø§Ù„ ÙƒØ¨ÙŠØ± Ø£Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØ§Ù†Øª ÙÙˆØ²Ù‹Ø§.';
        } else if (cleanedText.includes('lose') || cleanedText.includes('fail') || cleanedText.includes('x0')) {
          aiResultDiv.textContent = 'âŒ ØªØ­Ù„ÙŠÙ„ AI: Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø®Ø³Ø§Ø±Ø©.';
        } else {
          aiResultDiv.textContent = 'ğŸ¤– ØªØ­Ù„ÙŠÙ„ AI: Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù‘Ù Ø¨Ø¯Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©.';
        }

        resultDiv.appendChild(aiResultDiv);

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Cloud AI
        syncToCloud(cleanedText).then(cloudResponse => {
          if (cloudResponse && cloudResponse.suggestion) {
            const cloudDiv = document.createElement('div');
            cloudDiv.style.marginTop = '15px';
            cloudDiv.style.color = '#000066';
            cloudDiv.textContent = 'ğŸŒ ØªÙˆØµÙŠØ© Ø³Ø­Ø§Ø¨ÙŠØ©: ' + cloudResponse.suggestion;
            resultDiv.appendChild(cloudDiv);
          }
        });

      }).catch(err => {
        resultDiv.textContent = 'âŒ ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©:\n' + err.message;
      });
    }

    // Cloud AI Ø§Ù„Ù…Ø¯Ù…Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
    function getDeviceId() {
      let id = localStorage.getItem('cloud_device_id');
      if (!id) {
        id = 'device-' + Math.random().toString(36).substring(2, 10);
        localStorage.setItem('cloud_device_id', id);
      }
      return id;
    }

    async function syncToCloud(ocrText) {
      try {
        const payload = {
          text: ocrText,
          deviceId: getDeviceId(),
          timestamp: new Date().toISOString()
        };

        const res = await fetch('https://api.cloud-ai-linebet.net/sync', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const json = await res.json();
        return json;
      } catch (err) {
        console.warn("â›” ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ:", err.message);
        return { status: "offline", suggestion: "ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©." };
      }
    }
  </script>
</body>
</html>
