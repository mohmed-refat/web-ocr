<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>نظام Web OCR الذكي</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f2f2f2;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      color: #2c3e50;
    }
    select, input[type="file"] {
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #result {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 20px;
      text-align: right;
    }
  </style>

  <!-- مكتبة OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>🔍 نظام Web OCR الذكي لجميع ألعاب Linebet / 1xBet</h1>

  <label for="gameSelect">اختر اللعبة:</label>
  <select id="gameSelect">
    <optgroup label="🎯 Crash Games">
      <option value="Aviator">Aviator</option>
      <option value="JetX">JetX</option>
      <option value="Zeppelin">Zeppelin</option>
      <option value="Crash X">Crash X</option>
    </optgroup>
    <optgroup label="💣 ألعاب الألغام">
      <option value="Mines">Mines</option>
      <option value="Safe Box">Safe Box</option>
      <option value="Gold Mines">Gold Mines</option>
    </optgroup>
    <optgroup label="🎡 ألعاب العجلة">
      <option value="Wheel of Fortune">Wheel of Fortune</option>
      <option value="Mega Wheel">Mega Wheel</option>
      <option value="Spaceman">Spaceman</option>
    </optgroup>
    <optgroup label="🎰 كازينو">
      <option value="Blackjack">Blackjack</option>
      <option value="Andar Bahar">Andar Bahar</option>
      <option value="Teen Patti">Teen Patti</option>
      <option value="Baccarat">Baccarat</option>
      <option value="Dragon Tiger">Dragon Tiger</option>
    </optgroup>
    <optgroup label="🎲 ألعاب النرد">
      <option value="Dice">Dice</option>
      <option value="HiLo">HiLo</option>
      <option value="Sic Bo">Sic Bo</option>
    </optgroup>
    <optgroup label="🧱 ألعاب Plinko">
      <option value="Plinko Classic">Plinko Classic</option>
      <option value="Plinko X">Plinko X</option>
    </optgroup>
    <optgroup label="🏁 سباقات افتراضية">
      <option value="Horse Racing">Horse Racing</option>
      <option value="Dog Racing">Dog Racing</option>
    </optgroup>
    <optgroup label="⚽ رياضة افتراضية">
      <option value="Virtual Football">Virtual Football</option>
      <option value="Virtual Tennis">Virtual Tennis</option>
    </optgroup>
    <optgroup label="🎮 ألعاب مصغرة">
      <option value="777">777</option>
      <option value="XO">XO</option>
      <option value="Fruit Blast">Fruit Blast</option>
    </optgroup>
    <optgroup label="🧠 أخرى">
      <option value="Crash X">Crash X</option>
      <option value="Penalty Shootout">Penalty Shootout</option>
      <option value="Goal">Goal</option>
      <option value="Rock Paper Scissors">Rock Paper Scissors</option>
    </optgroup>
  </select>

  <br/>
  <input type="file" id="imageInput" accept="image/*" />
  <div id="result">📄 نتائج التحليل ستظهر هنا...</div>

  <script>
    // إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCijdq8Ji8L9e3dGoHK72LaAUWsz_e5V6Y",
      authDomain: "web-ocr-ai.firebaseapp.com",
      projectId: "web-ocr-ai",
      storageBucket: "web-ocr-ai.appspot.com",
      messagingSenderId: "847993614836",
      appId: "1:847993614836:web:a2b6e91c94426dd01549a1",
      measurementId: "G-TTQZPVWFL4"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // دالة التوصيات الذكية لكل لعبة
    function analyzeGameText(game, text) {
      let recommendation = "🧠 جاري تطوير التوصيات لهذه اللعبة...";
      const lowerText = text.toLowerCase();

      // Crash Games
      if (["Aviator","JetX","Zeppelin","Crash X"].includes(game)) {
        const matches = lowerText.match(/(\d+(\.\d+)?)[x×]/g);
        if (matches && matches.length > 3) {
          const last = parseFloat(matches.pop());
          const avg = matches.slice(-5).reduce((s,v) => s + parseFloat(v), 0) / Math.min(matches.length,5);
          if (last < 1.5) recommendation = '🔻 موجة منخفضة، انتظر قفزات أعلى.';
          else if (avg > 2.0) recommendation = '🚀 متوسط مرتفع، جولة بمضاعف متوسط مناسبة.';
          else recommendation = '⏳ راقب النتائج قليلاً.';
        } else {
          recommendation = '📊 بيانات غير كافية للتوصية.';
        }
      }
      // Mines Games
      else if (["Mines","Safe Box","Gold Mines"].includes(game)) {
        const bombs = lowerText.match(/\b[0-9]{1,2}\b/g) || [];
        if (bombs.length > 5) {
          const safeCount = bombs.filter(n=>parseInt(n)<=3).length;
          recommendation = safeCount>=3
            ? '✅ ابدأ من الزوايا.'
            : '⚠️ جرب نمط 2-2-1 من الوسط.';
        } else recommendation = '📄 وفر لقطة بنصائح أكثر.';
      }
      // Wheel Games
      else if (["Wheel of Fortune","Mega Wheel","Spaceman"].includes(game)) {
        const highs = lowerText.match(/\b(40|50|100)\b/g);
        recommendation = highs && highs.length>0
          ? '🔁 جوائز كبيرة، انتظر دورة.'
          : '💫 فرصة لربح الآن.';
      }
      // Casino Games
      else if (game==="Blackjack") {
        if (lowerText.includes("21")||lowerText.includes("blackjack"))
          recommendation = '🃏 اقتربت من 21، توقف عن السحب.';
        else if (lowerText.includes("bust"))
          recommendation = '💥 تجاوزت 21، انتبه للجولة القادمة.';
        else recommendation = '📈 جرب جولة خفيفة، راقب الأوراق.';
      }
      else if (["Andar Bahar","Teen Patti","Baccarat","Dragon Tiger"].includes(game)) {
        recommendation = '🧠 يُحلَّل قريباً بناءً على أنماط اللعب المتكررة.';
      }
      // Dice Games
      else if (["Dice","HiLo","Sic Bo"].includes(game)) {
        const nums = lowerText.match(/\b\d{1,2}\b/g) || [];
        if (nums.length>=3) {
          const avg = nums.slice(-3).reduce((a,b)=>a+parseInt(b),0)/3;
          recommendation = avg>50
            ? '🎲 الأرقام عالية، حاول على منخفض.'
            : '🎲 الأرقام منخفضة، حاول مرتفع.';
        } else recommendation = '📊 غير كافٍ لتحليل النرد.';
      }
      // Plinko Games
      else if (["Plinko Classic","Plinko X"].includes(game)) {
        recommendation = lowerText.includes("risk")
          ? '🔻 مخاطرة مرتفعة، اختر متوسط.'
          : '🧱 جرب مسار مائل لفرصة أفضل.';
      }
      // Racing Games
      else if (["Horse Racing","Dog Racing"].includes(game)) {
        recommendation = '🏁 محلل البيانات قيد التطوير لهذه السباقات.';
      }
      // Virtual Sports
      else if (["Virtual Football","Virtual Tennis"].includes(game)) {
        recommendation = '⚽ تحليل المباريات مقدم لاحقاً.';
      }
      // Mini Games
      else if (["777","XO","Fruit Blast"].includes(game)) {
        recommendation = lowerText.includes("win")||lowerText.includes("ربحت")
          ? '🍒 فوز مؤخر، فرصة ضئيلة الآن.'
          : '🍀 لم يفز أحد، جرب الجولة القادمة.';
      }
      // Other Games
      else if (game==="Penalty Shootout") {
        recommendation = '🥅 حاول اختيار الزاوية الأقل ظهوراً.';
      }
      else if (game==="Goal") {
        recommendation = '⚽ اختر زاوية مختلفة للهدف.';
      }
      else if (game==="Rock Paper Scissors") {
        recommendation = '✊📄✌️ تجنب التكرار، غيّر اختيارك.';
      }

      return recommendation;
    }

    // OCR + تحليل
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const game = document.getElementById('gameSelect').value;
      const resultDiv = document.getElementById('result');
      if (!file) return;

      resultDiv.innerHTML = "⏳ جاري تحليل الصورة...";
      Tesseract.recognize(file, 'ara', { logger: m=>console.log(m) })
      .then(({ data: { text } }) => {
        const rec = analyzeGameText(game, text);
        resultDiv.innerHTML = `
          <b>🎮 اللعبة:</b> ${game}<br>
          <b>📄 النص المستخرج:</b><br>${text}<hr>
          <b>🤖 التوصية الذكية:</b><br>${rec}
        `;
        // حفظ في Firebase
        const ts = Date.now();
        database.ref('ocr-results/'+ts).set({
          game, text, recommendation: rec, time: new Date().toLocaleString()
        });
      })
      .catch(err => {
        resultDiv.innerHTML = "❌ حدث خطأ أثناء التحليل.";
        console.error(err);
      });
    });
  </script>
</body>
</html>
