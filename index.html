<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>نظام Web OCR الذكي</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f2f2f2;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      color: #2c3e50;
    }
    select, input[type="file"], button {
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #result, #aiStatus {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 20px;
      text-align: right;
      line-height: 1.6;
    }
    #refreshBtn {
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    #refreshBtn:hover {
      background-color: #2980b9;
    }
  </style>

  <!-- مكتبة OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>

  <!-- تنبيه صوتي -->
  <audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
</head>
<body>
  <h1>🔍 نظام Web OCR الذكي لجميع ألعاب Linebet / 1xBet</h1>

  <label for="gameSelect">اختر اللعبة:</label>
  <select id="gameSelect">
    <optgroup label="🎯 Crash Games">
      <option value="Aviator">Aviator</option>
      <option value="JetX">JetX</option>
      <option value="Zeppelin">Zeppelin</option>
      <option value="Crash X">Crash X</option>
    </optgroup>
    <optgroup label="💣 ألعاب الألغام">
      <option value="Mines">Mines</option>
      <option value="Safe Box">Safe Box</option>
      <option value="Gold Mines">Gold Mines</option>
    </optgroup>
    <optgroup label="🎡 ألعاب العجلة">
      <option value="Wheel of Fortune">Wheel of Fortune</option>
      <option value="Mega Wheel">Mega Wheel</option>
      <option value="Spaceman">Spaceman</option>
    </optgroup>
    <optgroup label="🎰 كازينو">
      <option value="Blackjack">Blackjack</option>
      <option value="Andar Bahar">Andar Bahar</option>
      <option value="Teen Patti">Teen Patti</option>
      <option value="Baccarat">Baccarat</option>
      <option value="Dragon Tiger">Dragon Tiger</option>
    </optgroup>
    <optgroup label="🎲 ألعاب النرد">
      <option value="Dice">Dice</option>
      <option value="HiLo">HiLo</option>
      <option value="Sic Bo">Sic Bo</option>
    </optgroup>
    <optgroup label="🧱 ألعاب Plinko">
      <option value="Plinko Classic">Plinko Classic</option>
      <option value="Plinko X">Plinko X</option>
    </optgroup>
    <optgroup label="🏁 سباقات افتراضية">
      <option value="Horse Racing">Horse Racing</option>
      <option value="Dog Racing">Dog Racing</option>
    </optgroup>
    <optgroup label="⚽ رياضة افتراضية">
      <option value="Virtual Football">Virtual Football</option>
      <option value="Virtual Tennis">Virtual Tennis</option>
    </optgroup>
    <optgroup label="🎮 ألعاب مصغرة">
      <option value="777">777</option>
      <option value="XO">XO</option>
      <option value="Fruit Blast">Fruit Blast</option>
    </optgroup>
    <optgroup label="🧠 أخرى">
      <option value="Penalty Shootout">Penalty Shootout</option>
      <option value="Goal">Goal</option>
      <option value="Rock Paper Scissors">Rock Paper Scissors</option>
    </optgroup>
  </select>

  <br/>
  <input type="file" id="imageInput" accept="image/*" />
  <div id="result">📄 نتائج التحليل ستظهر هنا...</div>

  <!-- 🔮 حالة الذكاء -->
  <div id="aiStatus">
    <b>📊 ذكاء النظام الذاتي:</b><br>
    <div id="aiStrength">⚙️ جاري تحميل قوة الذكاء...</div>
    <div id="aiModules">📦 مكونات الذكاء قيد التحديث...</div>
    <div id="aiUpdate">🕓 آخر تحديث: جاري التحميل...</div>
  </div>

  <script>
    // إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCijdq8Ji8L9e3dGoHK72LaAUWsz_e5V6Y",
      authDomain: "web-ocr-ai.firebaseapp.com",
      projectId: "web-ocr-ai",
      storageBucket: "web-ocr-ai.appspot.com",
      messagingSenderId: "847993614836",
      appId: "1:847993614836:web:a2b6e91c94426dd01549a1",
      measurementId: "G-TTQZPVWFL4"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // تحليل النص والتوصيات
    function analyzeGameText(game, text) {
      let recommendation = "🧠 جاري تطوير التوصيات لهذه اللعبة...";
      const lowerText = text.toLowerCase();

      if (["Aviator","JetX","Zeppelin","Crash X"].includes(game)) {
        const matches = lowerText.match(/(\d+(\.\d+)?)[x×]/g);
        if (matches && matches.length > 3) {
          const last = parseFloat(matches.pop());
          const avg = matches.slice(-5).reduce((s,v) => s + parseFloat(v), 0) / Math.min(matches.length,5);
          if (last < 1.5) recommendation = '🔻 موجة منخفضة، انتظر قفزات أعلى.';
          else if (avg > 2.0) recommendation = '🚀 متوسط مرتفع، جولة بمضاعف متوسط مناسبة.';
          else recommendation = '⏳ راقب النتائج قليلاً.';
        } else {
          recommendation = '📊 بيانات غير كافية للتوصية.';
        }
      }
      else if (["Mines","Safe Box","Gold Mines"].includes(game)) {
        const bombs = lowerText.match(/\b[0-9]{1,2}\b/g) || [];
        if (bombs.length > 5) {
          const safeCount = bombs.filter(n=>parseInt(n)<=3).length;
          recommendation = safeCount>=3
            ? '✅ ابدأ من الزوايا.'
            : '⚠️ جرب نمط 2-2-1 من الوسط.';
        } else recommendation = '📄 وفر لقطة بنصائح أكثر.';
      }
      else if (["Wheel of Fortune","Mega Wheel","Spaceman"].includes(game)) {
        const highs = lowerText.match(/\b(40|50|100)\b/g);
        recommendation = highs && highs.length>0
          ? '🔁 جوائز كبيرة، انتظر دورة.'
          : '💫 فرصة لربح الآن.';
      }
      else if (game==="Blackjack") {
     <body>
  <h1>📸 نظام Web OCR الذكي لتحليل ألعاب Linebet</h1>

  <!-- رفع صورة -->
  <input type="file" id="imageInput" accept="image/*" />

  <!-- اختيار اللعبة -->
  <select id="gameSelect">
    <option value="">اختر اللعبة</option>
    <option value="Crash">🎢 Crash</option>
    <option value="Mines">💣 Mines</option>
    <option value="Blackjack">🃏 Blackjack</option>
    <option value="Aviator">✈️ Aviator</option>
    <option value="Dice">🎲 Dice</option>
    <option value="Roulette">🎯 Roulette</option>
    <!-- أضف ألعابًا أخرى لاحقًا -->
  </select>

  <!-- زر التحليل -->
<button id="analyzeBtn">🔍 تحليل الصورة</button>

  <!-- زر التحديث اليدوي -->
  <button id="refreshBtn" onclick="manualRefresh()">🔄 تحديث يدوي</button>

  <!-- النتيجة -->
  <div id="result">📤 يرجى اختيار صورة لتحليل نتائج اللعبة.</div>

  <!-- حالة الذكاء -->
  <div id="aiStatus">
    <h3>⚙️ حالة الذكاء الاصطناعي:</h3>
    <ul id="aiComponents">
      <li>Vision AI: 100%</li>
      <li>Pattern AI: 98%</li>
      <li>Reinforcement AI: 96%</li>
      <li>Emulator AI: 94%</li>
      <li>Behavioral AI: 95%</li>
      <li>Cloud AI Collective: 99%</li>
      <li>Voice Alert AI: 100%</li>
      <li>Risk Management AI: 93%</li>
      <li>Auto-Adapt AI: 97%</li>
      <li>Predictive Timing AI: 95%</li>
      <li>Community Trust AI: 91%</li>
      <!-- أضف المزيد حسب الحاجة -->
    </ul>
    <strong>📈 قوة الذكاء الذاتي: <span id="globalPower">98%</span></strong>
    </div>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4"></script>
<script>
  async function analyzeImage() {
    const imageInput = document.getElementById('imageInput');
    const resultDiv = document.getElementById('result');
    const gameType = document.getElementById('gameSelect').value;

    if (!imageInput.files.length || !gameType) {
      resultDiv.innerText = "📌 يرجى اختيار صورة واختيار اللعبة.";
      return;
    }

    const file = imageInput.files[0];
    resultDiv.innerText = "⏳ جارٍ تحليل الصورة باستخدام Vision AI...";

    // OCR باستخدام Tesseract.js
    const { data: { text } } = await Tesseract.recognize(file, 'eng', {
      logger: m => console.log(m)
    });

    resultDiv.innerText = "✅ تم استخلاص النص. جارٍ تحليل النتائج باستخدام الذكاء الاصطناعي...";

    // محاكاة التحليل الذكي
    const prediction = await simulateSmartAnalysis(text, gameType);

    // عرض التوصية
    resultDiv.innerHTML = `
      🧠 <strong>توصية ذكية:</strong><br>
      🔍 النص المستخرج: <pre>${text}</pre>
      📊 التوصية: <strong>${prediction}</strong>
    `;

    // تنبيه صوتي حسب الذكاء
    speakPrediction(prediction);
  }

  async function simulateSmartAnalysis(text, gameType) {
    let recommendation = "❌ لا يمكن التنبؤ بنتيجة حالياً.";
    const cleanText = text.toLowerCase();

    // نماذج ذكية بسيطة (قابلة للتطوير لاحقاً)
    if (gameType === "Crash") {
      if (cleanText.includes("1.00x")) recommendation = "🔴 لا تدخل، احتمال منخفض.";
      else if (cleanText.includes("2.00x") || cleanText.includes("3.00x")) recommendation = "🟡 دخول حذر، احتمالية متوسطة.";
      else if (cleanText.includes("5.00x") || cleanText.includes("10.00x")) recommendation = "🟢 فرصة قوية للدخول الآن!";
    }

    if (gameType === "Mines") {
      const bombs = (cleanText.match(/💣|bomb/gi) || []).length;
      recommendation = bombs >= 3 ? "⚠️ عدد كبير من الألغام، تجنب اللعب." : "✅ عدد ألغام منخفض، فرصة جيدة.";
    }

    if (gameType === "Blackjack" && cleanText.includes("21")) {
      recommendation = "🟢 بلاك جاك! لا تدخل الآن، نسبة فوزك منخفضة.";
    }

    return recommendation;
  }

  function speakPrediction(prediction) {
    const msg = new SpeechSynthesisUtterance();
    msg.text = prediction.replace(/🟢|🟡|🔴|✅|⚠️/g, ''); // إزالة الرموز
    msg.lang = "ar";
    window.speechSynthesis.speak(msg);
  }

  function manualRefresh() {
    const aiStatus = document.getElementById("aiStatus");
    const now = new Date().toLocaleTimeString();
    document.getElementById("globalPower").innerText = `${97 + Math.floor(Math.random() * 3)}%`;
    aiStatus.insertAdjacentHTML('beforeend', `<div>🔁 تم تحديث الذكاء في: ${now}</div>`);
  }
</script>
<!-- استدعاء aiModules.js بنظام ES Modules -->
<script type="module">
  import { aiModules } from './aiModules.js';  // تأكد من المسار النسبي الصحيح

  // 1. تهيئة كل مكون مفعّل
  aiModules.forEach(mod => {
    if (mod.enabled && typeof mod.init === 'function') {
      mod.init();
    }
  });

  // 2. دالة لتشغيل جميع المحللات بعد OCR
  async function runAllAnalyzers(context) {
    const outputs = {};
    for (let mod of aiModules) {
      if (mod.enabled && typeof mod.analyze === 'function') {
        try {
          const out = await mod.analyze(context);
          outputs[mod.name] = out;
        } catch (err) {
          console.error(`Error in ${mod.name}`, err);
        }
      }
    }
    return outputs;
  }

  // 3. ربط مع زر التحليل (تأكد من وجود id="analyzeBtn")
  document.getElementById('analyzeBtn').addEventListener('click', async () => {
    // استخراج الملف واللعبة من الواجهة
    const file = document.getElementById('imageInput').files[0];
    const game = document.getElementById('gameSelect').value;
    if (!file || !game) return alert('اختر صورة ولعبة أولاً!');

    // 4. استدعاء Vision AI أولاً لاستخراج النص
    const vision = aiModules.find(m => m.name === "Vision AI");
    const { text } = await vision.analyze({ file });

    // 5. ثم استدعاء باقي المكونات
    const allResults = await runAllAnalyzers({ file, text, game });
    console.log("🧩 All AI results:", allResults);

    // 6. مثلاً عرض النص المستخرج وبعض النتائج البسيطة
    document.getElementById('result').innerHTML = `
      <b>النص:</b> ${text.slice(0,200)}...<br>
      <b>Pattern AI:</b> ${allResults["Pattern AI"].patterns.join(", ")}
    `;
  });
          </script>
</body>
</html>
