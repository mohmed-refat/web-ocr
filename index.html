<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Web OCR</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      direction: rtl;
    }
    input[type="file"] {
      margin: 20px 0;
    }
    #result {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      font-size: 16px;
      text-align: right;
    }
    #history {
      margin-top: 30px;
      background: #e8e8e8;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§  Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - Web OCR</h1>
  <p>Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</p>
  <input type="file" accept="image/*" onchange="handleImage(event)">
  <div id="result">ğŸ“· ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØµÙˆØ±Ø©...</div>
  <div id="history"><strong>ğŸ•“ Ø¢Ø®Ø± 5 ØªØ­Ù„ÙŠÙ„Ø§Øª:</strong><ul id="historyList"></ul></div>

  <!-- Ù…ÙƒØªØ¨Ø© OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

  <!-- Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„ØµÙˆØªÙŠØ© -->
  <script>
    function speak(text) {
      if ('speechSynthesis' in window) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'ar-SA';
        window.speechSynthesis.speak(msg);
      }
    }
  </script>

  <script>
    const resultDiv = document.getElementById('result');
    const historyList = document.getElementById('historyList');

    function handleImage(event) {
      const file = event.target.files[0];
      if (!file) return;

      resultDiv.textContent = 'â³ Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...';

      Tesseract.recognize(file, 'eng', {
        logger: m => console.log(m)
      }).then(({ data: { text } }) => {
        const cleanedText = text.trim();
        const now = new Date().toLocaleString('ar-EG');
        let analysis = '';
        let voiceMessage = '';

        // ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ
        if (cleanedText.includes('win') || cleanedText.includes('Victory') || cleanedText.includes('x2')) {
          analysis = 'âœ… ÙÙˆØ² Ù…ØªÙˆÙ‚Ù‘Ø¹.';
          voiceMessage = 'ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙÙˆØ².';
        } else if (cleanedText.includes('lose') || cleanedText.includes('fail') || cleanedText.includes('x0')) {
          analysis = 'âŒ Ø®Ø³Ø§Ø±Ø© Ù…ØªÙˆÙ‚Ù‘Ø¹Ø©.';
          voiceMessage = 'ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø®Ø³Ø§Ø±Ø©.';
        } else {
          analysis = 'ğŸ¤– Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© ÙˆØ§Ø¶Ø­Ø©.';
          voiceMessage = 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø¯Ù‚Ø©.';
        }

        const fullResult = `ğŸ“„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ³ØªØ®Ø±Ø¬:\n${cleanedText}\n\nğŸ§  Ø§Ù„ØªØ­Ù„ÙŠÙ„:\n${analysis}\nğŸ“… Ø§Ù„ÙˆÙ‚Øª: ${now}`;
        resultDiv.textContent = fullResult;
        speak(voiceMessage);

        // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
        const history = JSON.parse(localStorage.getItem('ocr_history') || '[]');
        history.unshift({ time: now, result: analysis });
        if (history.length > 5) history.pop();
        localStorage.setItem('ocr_history', JSON.stringify(history));

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
        updateHistoryList();

      }).catch(err => {
        resultDiv.textContent = 'âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„:\n' + err.message;
        speak('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©.');
      });
    }

    function updateHistoryList() {
      const history = JSON.parse(localStorage.getItem('ocr_history') || '[]');
      historyList.innerHTML = '';
      history.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.time} - ${item.result}`;
        historyList.appendChild(li);
      });
    }

    // Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
    updateHistoryList();
  </script>
</body>
</html>
